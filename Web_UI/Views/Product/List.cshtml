@model IEnumerable<Product>
@using Entities.Concrete;
@using Microsoft.AspNetCore.Identity
@inject SignInManager<AppUser> SignInManager
@inject UserManager<AppUser> UserManager

@*@using X.PagedList
@using X.PagedList.Mvc.Core*@

<link rel="stylesheet" href="https://cdn.datatables.net/2.0.7/css/dataTables.dataTables.css" />


@{
    ViewData["Title"] = "List";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<h5>
    <i class="fa fa-building">&nbsp;Mağazanız : @UserManager.GetUserAsync(User).Result.NameSurname</i>
</h5>
<small>Size ait ürünler listelenmektedir.</small>


<center>
    @if (Model.Count() == 0)
    {
        <p>Henüz bir ürün eklemediniz.</p>
    }
    else
    {
        <h5 id="urunadet"> @Model.Count() Adet Ürün Listeleniyor</h5>
    }
</center>


<a href="/Product/StoreOrder/" class="btn border-0 btn-primary">Gelen Siparişler&nbsp;<i class="fa fa-money"></i></a>
&nbsp;

<a href="/Product/Addpro/" class="btn border-0 btn-success">Yeni Ürün Kayıt&nbsp;<i class="fa fa-plus"></i></a>

<br />
<br />

@if (Model.Count() != 0)
{

    <center style="font-family:'Segoe UI'" class="text-center">
        <div class="container col-md-12">
            <table class="col-md-12 table table-sm table-hover" id="tablem">
                <thead>
                    <tr>
                        <td>Görsel</td>
                        <td>Ürün Adı</td>
                        <td>Fiyat</td>
                        <td>Stok (Adet)</td>
                        <td>İşlemler</td>
                    </tr>
                </thead>
                <tbody id="verim">
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td> <img src="@item.PhotoUrl" width="45" height="45" /> </td>
                            <td width="35%"><a href="/Product/Detay/@item.ProductId">@item.Name ...</a></td>
                            <td>@item.Price ₺</td>
                            <td>@item.Stock</td>
                            <td>
                                @if (item.Status == false)
                                {
                                    <a href="#" data-id="@item.ProductId" data-name="@item.Name" class="btn btn-warning btn-sm" id="delbtnprd">Satışa Kapalı&nbsp; <i class="fa fa-times"></i></a>
                                }
                                else
                                {
                                    <a href="#" data-id="@item.ProductId" data-name="@item.Name" class="btn btn-success btn-sm" id="delbtnprd">Yayında&nbsp; <i class="fa fa-check"></i></a>
                                }
                                @*<button class="btn btn-primary btn-sm" data-target="#modal1" data-toggle="modal" data-id="@item.ProductId" id="editbtnprd" type="button">Düzenle&nbsp;<i class="fa fa-edit"></i></button>*@
                                <a href="/Product/ProductEdit/@item.ProductId" class="btn btn-primary btn-sm">Düzenle&nbsp;<i class="fa fa-edit"></i></a>
                                <a id="editphotobtn" class="btn btn-info btn-sm" href="/Product/ProductPhotoEdit/@item.ProductId">Görseller&nbsp;<i class="fa fa-arrow-right"></i></a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </center>

}




<script type="text/javascript">


    $(document).ready(function () {
        $("#tablem").DataTable();
    });


    $(document).on("click", "#btnupd", function () {
        $("#tablem").load(window.location.href + " #tablem");
    });


    $(document).on("click", "#editbtnprd", function () {
        var datid = $(this).data("id");
        $('#productedit').load('@Url.Action("ProductEdit", "Product")?id=' + datid);
    });


    $(document).on("click", "#editphotobtn", function () {
        var datid = $(this).data("id");
        var modalhead = $(this).data("name");
        document.getElementById("photomodalhead").innerHTML = modalhead;
        $('#photosedit').load('@Url.Action("ProductPhotoEdit", "Product")?id=' + datid);
    });


    $(document).on("click", "#delbtnprd", function () {
        var id = $(this).data("id");
        var name = $(this).data("name");
        swal({
            title: "Ürün Durumu Değiştirilecektir?",
            text: "Ürün Bilgisi : " + name,
            icon: "warning",
            buttons: true,
            dangerMode: true,
        })
            .then((willDelete) => {
                if (willDelete) {
                    $.ajax({
                        type: "get",
                        url: "/Product/Delete?id=" + id,
                        success: function (funk) {
                            $("#tablem").load(window.location.href + " #tablem");
                            swal("İşlem başarılı");
                        }
                    });
                }
            });
    });


</script>


