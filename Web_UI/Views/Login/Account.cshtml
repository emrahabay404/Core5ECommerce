@using Entities.Concrete;
@using Microsoft.AspNetCore.Identity
@inject SignInManager<AppUser> SignInManager
@inject UserManager<AppUser> UserManager

@model AppUser


@{
    ViewData["Title"] = "Account";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap Alerts with Icons</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        /* Custom style to set icon size */
        .alert i[class^="bi-"] {
            font-size: 2.5em;
            line-height: 1;
        }
    </style>
</head>


<h4>Hesabım&nbsp;<img src="https://icon-library.com/images/account-icon/account-icon-16.jpg" width="30" height="30" /></h4>


<div class="container" id="cnt">
    <div class="col-lg-12" style="font-size:x-large;background-color:aliceblue">
        <button class="btn border-0 btn-outline-info btn-default" id="generalbtn">Genel <img src="https://play-lh.googleusercontent.com/hrBju7zzcoO2Ohimi_v73I9FQ9ImFmx7L5f6EDwhjTYUHVnACZx-t67PEK6nX3FgxA" width="30" height="30" />  </button>
        &nbsp;<button class="btn border-0 btn-outline-info btn-default" id="walletbtn">Cüzdanım <img src="https://pngimg.com/uploads/wallet/wallet_PNG7511.png" width="30" height="30" />  </button>
        &nbsp;<button class="btn border-0 btn-outline-info btn-default" id="pwdbtn">Şifre Değiştir <img src="https://www.seekpng.com/png/detail/430-4307046_forgot-password-icon-png-icon-for-username-and.png" width="30" height="30" />  </button>
        &nbsp;<button class="btn border-0 btn-outline-info btn-default" id="buyerbtn">Satıcı Olmak <img src="https://cdn-icons-png.flaticon.com/512/1924/1924844.png" width="30" height="30" />  </button>
        &nbsp;<button data-target="#modal1" data-toggle="modal" class="btn border-0 btn-outline-info btn-default" id="mailbtn">Mail Adresi <img src="https://upload.wikimedia.org/wikipedia/commons/3/3d/Envelope-letter-icon.png" width="30" height="30" />  </button>
    </div>
    <br />
    <div class="col-lg-12" id="rightmenu">

        <div id="succalert" style="font-size:large;display:none">
            <div role="alert" class="alert alert-success alert-dismissible d-flex align-items-center fade show">
                <i class="bi-check-circle-fill"></i>
                <strong class="mx-2">Bilgi!</strong> İşlem başarıyla gerçekleşti.
                <button id="closesuccalert" class="btn btn-sm btn-secondary"><i class="fa fa-times"></i></button>
            </div>
        </div>

        <div id="erroralert" style="font-size: large; display: none">
            <div role="alert" class="alert alert-warning alert-dismissible d-flex align-items-center fade show">
                <i class="bi-exclamation-octagon-fill"></i>
                <strong class="mx-2">Uyarı!</strong> İşlem başarısız.Lütfen kontrol edip tekrar deneyin.
                <button id="closeerroralert" class="btn btn-sm btn-secondary"><i class="fa fa-times"></i></button>
            </div>
        </div>


        <div id="generalmenu">
            @*<form method="post" action="/Login/Userupdate">*@
            <div class="form-group row">
                <label class="col-sm-2 col-form-label">Fotoğraf</label>
                <div class="col-sm-8">
                    <img src="@Model.ImageUrl" width="140" height="140" />
                    <button id="imgremove" class="btn btn-sm btn-danger"><i class="fa fa-times"></i></button>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-2 col-form-label">Ad Soyad</label>
                <div class="col-sm-8">
                    <input type="text" id="NameSurname" class="form-control form-control-sm " value="@Model.NameSurname">
                </div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label">Mail Adresi</label>
                <div class="col-sm-8">
                    <input type="email" readonly class="form-control form-control-sm " value="@Model.Email">
                </div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label">Kullanıcı Adı</label>
                <div class="col-sm-8">
                    <input type="text" id="UserName" readonly class="form-control form-control-sm " value="@Model.UserName">
                    <small style="color:red">Bu alan değiştirilemez.</small>
                </div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label">Telefon No</label>
                <div class="col-sm-8">
                    <input type="text" id="PhoneNumber" class="form-control form-control-sm " value="@Model.PhoneNumber">
                </div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label">Meslek</label>
                <div class="col-sm-8">
                    <input type="text" id="Job" class="form-control form-control-sm " value="@Model.Job">
                </div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label">Hakkımda</label>
                <div class="col-sm-8">
                    <textarea id="About" class="form-control">@Model.About</textarea>
                </div>
            </div>
            <div class="form-group row">
                <label class="col-sm-2 col-form-label"></label>
                <div class="col-sm-8">
                    <button type="submit" id="usrupdtatebtn" class="btn btn-success">Güncelle<i class="fa fa-refresh"></i></button>
                </div>
            </div>
            @*</form>*@
        </div>



        <div id="walletmenu">
            <p>Cüzdanım <img src="https://pngimg.com/uploads/wallet/wallet_PNG7511.png" width="20" height="20" /> </p>
            <hr />
            @if (ViewBag.walletno < 1)
            {
                <small>Şu anda mevcut bir cüzdan hesabınız yok,<br /><button id="walletaddbtn" class="btn border-0 btn-sm btn-info" href="#">Hemen Oluştur <i class="fa fa-plus"></i>  </button> </small>
            }
            else
            {
                <p>Cüzdan No: @ViewBag.walletno </p>
                <p>Bakiye:<b> @ViewBag.walletbalance ₺</b></p>
                <div class="form-group row">
                    <label class="col-sm-1 col-form-label">Tutar:</label>
                    <div class="col-sm-3">
                        <input id="walletmoney" type="text" placeholder="Aktarılacak Tutar" class="form-control-sm form-control" value="">
                    </div>
                </div>
                <button class="btn border-0 btn-success btn-sm" id="walletbalanceadd">Para Yükle&nbsp;<i class="fa fa-credit-card"></i></button>
                <br />
                <br />
                <button class="btn border-0 btn-sm btn-danger" id="removewallet">Cüzdanı Sil&nbsp;<i class="fa fa-times"></i></button>
            }
        </div>



        <div id="pwdmenu" class="col-md-4">
            <p>Şifre Değişikliği <img src="https://www.seekpng.com/png/detail/430-4307046_forgot-password-icon-png-icon-for-username-and.png" width="20" height="20" /> </p>  <hr /> <br />

            <input type="password" class="form-control form-control-sm" id="Currentpassword" placeholder="Mevcut Şifre" required /><br />
            <input type="password" class="form-control form-control-sm" id="Newpassword" placeholder="Yeni Şifre" required /><br />
            <input type="password" class="form-control form-control-sm" id="Confirmpassword" placeholder="Şifre Onay" required /><br />
            <button type="submit" id="btnchnpwd" class="btn btn-success btn-sm">Değiştir</button>
        </div>

        <div id="buyermenu" class="col-md-6">
            @if (ViewBag.sellerstatus == "noaccept")
            {
                <br />
                <p class="col-md-12"><i class="fa fa-child"></i>Satıcı olma talebiniz gönderilmiştir. Onaylandıgı taktirde ürünlerinizi satmaya başlayabilirsiniz.</p>
                <button id="reqselcancel" class="btn border-0 btn-warning">Talebimi İptal Et &nbsp;<i class="fa fa-times"></i></button>
            }
            @if (ViewBag.sellerstatus == "accept")
            {
                <br />
                <p>Zaten satıcısınız. Ürünler ekleyebilir ve sipariş alabilirsiniz.</p>
                <a class="btn btn-danger" href="/Login/CancelSeller/" onclick="return confirm('Satıcı Üyeliğiniz İptal Edilecektir. Onaylıyor Musunuz?')" id="sellercancel">Satıcı Olmak İstemiyorum&nbsp;<i class="fa fa-user-times"></i></a>
            }
            @if (ViewBag.sellerstatus == "formshow")
            {
                <h5>Satıcı Olma Talebi İçin Formu Eksiksiz Doldurun</h5> <hr />
                <form method="post" action="/Login/Sellerrequest/">
                    <input hidden name="UserName" value="@Model.UserName" />
                    <div class="form-group row">
                        <label class="col-sm-4 col-form-label">Firma Adı(Tam)</label>
                        <div class="col-sm-8">
                            <input type="text" name="FullName" required class="form-control form-control-sm " value="">
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-sm-4 col-form-label">Firma Adresi</label>
                        <div class="col-sm-8">
                            <input type="text" name="StoreAddress" required class="form-control form-control-sm " value="">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-4 col-form-label">Vergi Numarası</label>
                        <div class="col-sm-8">
                            <input type="text" name="StoreTaxNo" required class="form-control form-control-sm " value="">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-4 col-form-label">Vergi Dairesi</label>
                        <div class="col-sm-8">
                            <input type="text" name="StoreTaxOffice" required class="form-control form-control-sm " value="">
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="col-sm-4 col-form-label">Banka</label>
                        <div class="col-sm-8">
                            <input type="text" name="Bankname" class="form-control form-control-sm " value="">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-4 col-form-label">Hesap No</label>
                        <div class="col-sm-8">
                            <input type="text" name="AccountNo" class="form-control form-control-sm " value="">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-4 col-form-label">   IBAN No </label>
                        <div class="col-sm-8">
                            <input type="text" name="IBANNo" class="form-control form-control-sm " value="">
                        </div>
                    </div>
                    <button type="submit" id="reqsel" class="btn btn-success">Kaydet ve Gönder<i class="fa fa-check"></i></button>
                </form>
            }
        </div>


    </div>
</div>




<form method="post" action="/Login/Sendmail/">
    <div class="modal fade" id="modal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Kullanıcı Mail Değiştirme Formu </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group row">
                        <label class="col-sm-4 col-form-label">Mevcut Mail Adresi</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control form-control-sm " value="">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-4 col-form-label">Yeni Mail Adresi</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control form-control-sm " value="">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-4 col-form-label"></label>
                        <div class="col-sm-8">
                            <button type="submit" id="mailchngbtn" class="btn btn-success">Değiştir<i class="fa fa-check"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>



<script type="text/javascript">


    $(document).on("click", "#closesuccalert", function () {
        $("#succalert").hide();
    });

    $(document).on("click", "#closeerroralert", function () {
        $("#erroralert").hide();
    });

    $(document).on("click", "#usrupdtatebtn", function () {
        let mydata =
        {
            UserName: $("#UserName").val(),
            NameSurname: $("#NameSurname").val(),
            PhoneNumber: $("#PhoneNumber").val(),
            Job: $("#Job").val(),
            About: $("#About").val()
        };
        $.ajax({
            type: "post",
            url: "/Login/Userupdate/",
            data: mydata,
            async: true,
            success: function () {
                javascript: scroll(0, 0);
                $("#succalert").show();
                $("#erroralert").hide();

            },
            error: function (funk) {
                javascript: scroll(0, 0);
                $("#erroralert").show();
                $("#succalert").hide();
            }
        });
    });


    $(document).on("click", "#reqselcancel", function () {
        swal({
            title: "Emin Misin?",
            text: "İşlemi onayladıgınız takdirde ürünleriniz artık vitrinde sergilenmeyecek ve sipariş alamayacaksınız.",
            icon: "warning",
            buttons: true,
            dangerMode: true,
        })
            .then((willDelete) => {
                if (willDelete) {
                    $.ajax({
                        type: "get",
                        url: "/Login/CancelSellerRequest/",
                        success: function (funk) {
                            swal("", "Satıcı olmak için gönderdiğiniz talep iptal edilmiştir.")
                                .then((value) => {
                                    window.location.href = "@Url.Action("Account", "Login")";
                                });
                        }
                    });
                }
            });

    });


    $(document).on("click", "#btnchnpwd", function () {
        let mydata =
        {
            Currentpassword: $("#Currentpassword").val(),
            Newpassword: $("#Newpassword").val(),
            Confirmpassword: $("#Confirmpassword").val()
        };
        $.ajax({
            url: "/Login/Newpassword/",
            type: "post",
            async: true,
            data: mydata,
            success: function (funk) {
                if (funk == true) {
                    swal("Şifreniz Başarıyla Değiştirildi", "", "success")
                        .then((value) => {
                            window.location.href = "@Url.Action("Account", "Login")";
                        });
                }
                else {
                    swal("", "Hata oluştu. Lütfen kontrol ederek tekrar deneyin", "warning");
                }
            }
        });
    });


    $(document).on("click", "#walletbalanceadd", function () {
        var datid = $("#walletmoney").val();
        if (datid > 0) {
            $.ajax({
                type: "post",
                url: "/Login/Walletbalanceadd?money=" + datid,
                success: function (funk) {
                    swal((datid + " ₺ Cüzdanınıza Aktarıldı"), "Bakiye yükleme işlemi başarıyla tamamlandı", "success");
                }
            });
        }
        else {
            swal("", "Lütfen tutarı kontrol edin", "warning");
        }

    });

    $(document).on("click", "#walletaddbtn", function () {
        $.ajax({
            type: "post",
            url: "/Login/Walletadd/",
            success: function (funk) {
                swal("", "Cüzdanınız başarıyla oluşturuldu", "success");

            }
        });
    });

    $(document).on("click", "#removewallet", function () {
        $.ajax({
            type: "get",
            url: "/Login/Walletdelete/",
            success: function (funk) {
                swal("", "Cüzdanınız başarıyla kaldırıldı.Dilerseniz daha hızlı alışveriş için tekrardan cüzdan oluşturabilir ve içerisine bakiye yükleyebilirsiniz...", "warning");
            }
        });
    });


    $(document).on("click", "#imgremove", function () {
        var datid = $(this).data("id");
        var name = $(this).data("name");
        swal({
            title: "Fotoğraf Kaldırılacaktır",
            text: "Daha sonra yeniden ekleyebilirsiniz: " + name,
            icon: "warning",
            buttons: true,
            dangerMode: true,
        })
            .then((willDelete) => {
                if (willDelete) {
                    $.ajax({
                        type: "get",
                        url: "/dsfdds/ddsddf?id=" + datid,
                        success: function (funk) {
                            $("#tablem").load(window.location.href + " #tablem");
                            swal("", "Fotoğraf başarıyla kaldırıldı", "success");
                        },
                        error: function (funnk) {
                            swal("", "İşlem sırasında hata oluştu", "error");
                        }
                    });
                }
            });
    });


    $(document).ready(function () {
        $("#pwdmenu").hide();
        $("#buyermenu").hide();
        $("#walletmenu").hide();
        $("#generalmenu").hide();
    });

    $("#generalbtn").click(function () {
        $("#pwdmenu").hide();
        $("#buyermenu").hide();
        $("#walletmenu").hide();
        $("#generalmenu").show();

    });

    $("#walletbtn").click(function () {
        $("#pwdmenu").hide();
        $("#buyermenu").hide();
        $("#generalmenu").hide();
        $("#walletmenu").show();
    });
    $("#pwdbtn").click(function () {
        $("#walletmenu").hide();
        $("#buyermenu").hide();
        $("#generalmenu").hide();
        $("#pwdmenu").show();
    });
    $("#buyerbtn").click(function () {
        $("#pwdmenu").hide();
        $("#walletmenu").hide();
        $("#generalmenu").hide();
        $("#buyermenu").show();
    });

</script>


